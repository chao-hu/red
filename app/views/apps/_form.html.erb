<%= content_for :custom_assets do %>
  <%= javascript_include_tag :angularjs %>
<% end %>

<%= javascript_tag do %>
  var appObj = JSON.parse('<%= @app.to_json.html_safe%>');
  $('#appTab a:first').tab('show');
<% end %>

<div ng-app="app">
  <div class='row' ng-controller='AppController'>
    <form class="form-horizontal" name="appForm" ng-submit="submit()">
      <div class="form_section">
        <div class="form-group" ng-class="{ 'has-error' : appForm.name.$invalid && (appForm.name.$dirty || submitted)}" >
          <label for="name" class="col-sm-2 control-label"><%= t("app.name") %></label>
          <div class="col-sm-10">
            <input type="input" name="name" class="form-control" id="name" ng-model="app.name" ng-required="true">
             <p ng-show="appForm.name.$invalid && (appForm.name.$dirty || submitted)" class="help-block">You name is required.</p>
          </div>
        </div>

        <div class="form-group">
          <label for="description" class="col-sm-2 control-label"><%= t("app.description") %></label>
          <div class="col-sm-10">
            <input type="input" name="description" class="form-control" id="description" ng-model="app.description">
          </div>
        </div>


        <div class="form-group" ng-class="{ 'has-error' : appForm.image.$invalid && (appForm.image.$dirty || submitted)}" >
          <label for="image" class="col-sm-2 control-label"><%= t("app.select_image") %></label>
          <div class="col-sm-10">
            <input type="input" name="image" class="form-control" id="image" ng-model="app.image">
             <p ng-show="appForm.image.$invalid && (appForm.image.$dirty || submitted)" class="help-block">You name is required.</p>
          </div>
        </div>

        <div class="form-group" ng-class="{ 'has-error' : appForm.network.$invalid && (appForm.network.$dirty || submitted)}" >
          <label for="network" class="col-sm-2 control-label"><%= t("app.network") %></label>
          <div class="col-sm-10">
              <label><input value="bridge" type="radio" name="network" ng-model="app.network" /><%= t("app.bridge") %></label>
              <label><input value="host" type="radio" name="network" ng-model="app.network" /><%= t("app.host") %></label>
              <label><input value="user" type="radio" name="network" ng-model="app.network" /><%= t("app.user") %></label>
              <p ng-show="appForm.network.$invalid && (appForm.network.$dirty || submitted)" class="help-block">You name is required.</p>
          </div>
        </div>

        <div class="form-group" ng-class="{ 'has-error' : appForm.customized_network_name.$invalid && (appForm.customized_network_name.$dirty || submitted)}" ng-show="app.network != 'bridge' && app.network != 'host'">
          <label for="customized_network_name" class="col-sm-2 control-label"><%= t("app.network") %></label>
          <div class="col-sm-10">
            <input type="input" name="customized_network_name" class="form-control" id="customized_network_name" ng-model="app.customized_network_name" ng-required="app.network != 'bridge' && app.network != 'host'">
             <p ng-show="appForm.customized_network_name.$invalid && (appForm.customized_network_name.$dirty || submitted)" class="help-block">You name is required.</p>
          </div>
        </div>

        <div class="form-group" ng-class="{ 'has-error' : appForm.portmappings.$invalid && (appForm.portmappings.$dirty || submitted)}" ng-show="app.network == 'bridge' || app.network == 'host'">
          <label for="portmappings" class="col-sm-2 control-label"><%= t("app.portmappings") %></label>
          <div class="col-sm-10">
            <table class="table table-bordered col-md-6 col-sm-12">
              <thead>
                <td>Port Name</td>
                <td ng-if="app.network=='bridge'">Container Port</td>
                <td ng-if="app.network=='host'">Host Port</td>
                <td>Proto</td>
                <td></td>
              </thead>
              <tbody>
                <tr  ng-repeat="portmapping in app.portmappings">
                  <td> <input type="input" class="form-control" ng-model="portmapping.name" ng-required=true> </td>
                  <td ng-if="app.network=='bridge'"> <input type="input" class="form-control" ng-model="portmapping.containerPort" ng-required=true> </td>
                  <td ng-if="app.network=='host'"> <input type="input" class="form-control" ng-model="portmapping.hostPort" ng-required=true> </td>
                  <td>
                    <select class='form-control' ng-model='portmapping.proto' ng-required=true>
                      <option value="tcp"> TCP </option>
                      <option value="udp"> UDP </option>
                    </select>
                  </td>
                  <td><a class="btn btn-danger btn-sm" ng-click="removePortmapping($index)"><%= fa_icon(:minus)%> </a></td>
                </tr>
                <tr>
                  <td colspan=5><a class="btn btn-primary btn-sm" ng-click="morePortmapping()"><%= fa_icon(:plus)%> Add Port Map </a></td>
                </tr>
              </tbody>
            </table>
             <p ng-show="appForm.portmappings.$invalid && (appForm.portmappings.$dirty || submitted)" class="help-block">You name is required.</p>
          </div>
        </div>

      </div>


      <div class='form_section'>
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist" id='appTab'>
          <li role="presentation" class="active"><a href="#command" aria-controls="command" role="tab" data-toggle="tab"><%= t('service.command') %></a></li>
          <li role="presentation"><a href="#volumes" aria-controls="volumes" role="tab" data-toggle="tab"><%= t('service.volumes') %></a></li>
          <li role="presentation"><a href="#uri" aria-controls="uri" role="tab" data-toggle="tab"><%= t('service.uri') %></a></li>
          <li role="presentation"><a href="#networking" aria-controls="networking" role="tab" data-toggle="tab"><%= t('service.networking') %></a></li>
          <li role="presentation"><a href="#labels" aria-controls="labels" role="tab" data-toggle="tab"><%= t('service.labels') %></a></li>
          <li role="presentation"><a href="#security" aria-controls="security" role="tab" data-toggle="tab"><%= t('service.security') %></a></li>
          <li role="presentation"><a href="#health_check" aria-controls="health_check" role="tab" data-toggle="tab"><%= t('service.health_check') %></a></li>
          <li role="presentation"><a href="#scheduling" aria-controls="scheduling" role="tab" data-toggle="tab"><%= t('service.scheduling') %></a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="command">
            <%= render partial: 'apps/form/command' %>
          </div>

          <div role="tabpanel" class="tab-pane" id="volumes">
            <%= render partial: 'apps/form/volumes' %>
          </div>

          <div role="tabpanel" class="tab-pane" id="uri">
            <%= render partial: 'apps/form/uri' %>
          </div>

          <div role="tabpanel" class="tab-pane" id="networking">
            <%= render partial: 'apps/form/networking' %>
          </div>

          <div role="tabpanel" class="tab-pane" id="labels">
            <%= render partial: 'apps/form/labels' %>
          </div>

          <div role="tabpanel" class="tab-pane" id="security">
            <%= render partial: 'apps/form/security' %>
          </div>

          <div role="tabpanel" class="tab-pane" id="health_check">
            <%= render partial: 'apps/form/health_check' %>
          </div>

          <div role="tabpanel" class="tab-pane" id="scheduling"
            <%= render partial: 'apps/form/scheduling' %>
          </div>
        </div>
      </div>

      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button type="submit" class="btn btn-primary btn-lg">Submit</button>
          <%= link_to t("common.cancel"), services_path %>
        </div>
      </div>
    </form>
  </div>
</div>











